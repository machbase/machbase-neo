---
layout: default
parent: TQL API
title: Utilities
nav_order: 41
has_children: false
---

# Utilities
{: .no_toc}

Utility functions can be commonly used as parameters of any functions.

1. TOC
{: toc }

## Context

### context()

*Syntax*: `context()`

Returns context object of the script runtime.

### key()

*Syntax*: `key()`

Returns the key of the current record.

### value()

*Syntax*: `value( [index] )`

- `index` *int* index of the value array

Returns the whole value of the current records in array.
If the index is given, it returns the element of the values.

For example, If the current value is `[0, true, "hello", "world"]`

- `value()` returns the whole value array `[0, true, "hello", "world"]`
- `value(0)` returns the first element of the value `0`
- `value(3)` returns the last element of the value `"world"`

### payload()

*Syntax*: `payload()`

Returns the current input stream that sent from caller of the *tql* script.
If the *tql* script is called via HTTP, the result of `payload()` is the stream of the body content of POST request.
If the *tql* script is called via MQTT, the `payload()` returns the payload of the PUBLISH message.

### param()

*Syntax*: `param( name )`

- `name` *string* name of the query parameter

When the *tql* script is called via HTTP, the requested query parameters can be accessed by `param()` function.

## Time

### time()

*Syntax*: `time( number|string [, duration] )`

*Example)*

- `time('now')` return current time.
- `time('now', '-10s50ms')` return the time 10.05 seconds before from now.
- `time('now -10s50ms')` return the time 10.05 seconds before from now.
- `time(1672531200*1000000000)` returns the time of Jan-1-2023 AM 12:00:00

### roundTime()

*Syntax*: `roundTime( time, duration )`

Returns rounded time.

*Example)*

- `roundTime(time('now'), '1h')`
- `roundTime(key(), '1s')`

### parseTime()

*Syntax*: `parseTime( time, format, timezone )`

- `time` *string* time expression
- `format` *string* time format expression
- `timezone` *tz* timezone value typically use `tz()` function to get the demand location


*Example)*

- `parseTime("2023-03-01 14:01:02", "DEFAULT", tz("Asia/Tokyo"))`
- `parseTime("2023-03-01 14:01:02", "DEFAULT", tz("local"))`

### tz()

*Syntax*: `tz( name )`

Returns time zone that matched with the given name

*Example)*
- `tz('local')`
- `tz('UTC')`
- `tz('EST')`
- `tz("Europe/Paris")`

## Others

### round()

*Syntax*: `roundTime( number, mod )`

Returns rounded number.

*Example)*

- `round(key(), 10)`

### count()

*Syntax*: `count( array|tuple )`

Returns the number of the elements.

<!-- ### len() -->

<!-- ### element() -->

